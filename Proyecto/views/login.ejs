<%- include('partials/header') %>

<div class="row" style="margin-top:40px;">
    <div class="col s12 m6 offset-m3">

        <div class="nes-container with-title login-card">
            <p class="title login-title">Iniciar sesión</p>

            <!-- Sección: formulario de inicio de sesión (usuario no verificado) -->
            <% if (!validated) { %>

            <form action="/login" method="POST">
                <label>Correo</label>
                <input type="email" name="email" value="<%= email %>" required>

                <label>Contraseña</label>
                <input type="password" name="password" value="<%= password %>" required>

                <button class="nes-btn is-primary full" type="submit">Entrar</button>
            </form>

            <% if (notFound) { %>
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    M.toast({html: "Credenciales incorrectas", classes: "red darken-2"});
                });
            </script>
            <% } %>

            <% } else { %>
            <!-- Sección: usuario verificado (mostrar opciones) -->

            <h5 class="center">Acceso verificado</h5>

            <h6 class="center">Bienvenido <%= user.email %></h6>

            <div class="center" style="margin-top:20px;">

                <a href="/" class="nes-btn is-primary" style="width:70%;">Entrar al sistema</a>

                <br><br>

                <!-- Botón: abrir modal de registro -->
                <a href="#modalNewUser" class="nes-btn is-success modal-trigger" style="width:70%;">
                    Registrar nuevo usuario
                </a>

            </div>

            <% } %>

            <!-- Toast global: mostrar mensajes informativos -->
            <% if (toast) { %>
            <script>
                document.addEventListener("DOMContentLoaded", () => {
                    M.toast({html: "<%= toast %>", classes: "blue darken-2"});
                });
            </script>
            <% } %>

        </div>

    </div>
</div>

<!-- Modal: formulario para registrar nuevo usuario -->
<div id="modalNewUser" class="modal">
    <div class="modal-content">
        <h4>Registrar usuario nuevo</h4>

        <form action="/register-from-login" method="POST">

            <label>Correo</label>
            <input type="email" name="email" required>

            <label>Contraseña</label>
            <input type="password" name="password" required>

            <br>

            <button class="nes-btn is-success">Guardar</button>

            <a class="modal-close nes-btn is-error" style="margin-left:10px;">Cancelar</a>
        </form>
    </div>
</div>

<!-- Inicializar modales de Materialize al cargar el DOM -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    M.Modal.init(document.querySelectorAll('.modal'));
});
</script>

<%- include('partials/footer') %>
